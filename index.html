<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Netrunner">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/svg+xml" href="apple-touch-icon.svg">
  <title>Netrunner v2 - AI Operations Command Center</title>
  <style>
    :root {
      --bg: #0a0a0f;
      --bg-elev: #10131b;
      --bg-soft: #161b24;
      --text: #e6edf3;
      --text-muted: #9aa4b2;
      --border: #273244;
      --accent: #00a19a;
      --ok: #059669;
      --warn: #d97706;
      --bad: #dc2626;
      --special: #7c3aed;
      --shadow: 0 16px 40px rgba(0, 0, 0, 0.35);
      --radius: 12px;
      --font-mono: "JetBrains Mono", "Fira Code", Consolas, "Courier New", monospace;
      --font-ui: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    html[data-theme="light"] {
      --bg: #f3f6fb;
      --bg-elev: #ffffff;
      --bg-soft: #edf2f8;
      --text: #141a22;
      --text-muted: #4e5b6b;
      --border: #c8d2df;
      --accent: #007c76;
      --ok: #0d8a58;
      --warn: #a76608;
      --bad: #b21f2d;
      --special: #6435d8;
      --shadow: 0 12px 28px rgba(34, 42, 55, 0.12);
    }

    * { box-sizing: border-box; }
    html, body { overflow-x: hidden; max-width: 100vw; }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: var(--font-ui);
      background:
        radial-gradient(circle at 10% 10%, rgba(0, 161, 154, 0.13), transparent 32%),
        radial-gradient(circle at 90% 20%, rgba(124, 58, 237, 0.1), transparent 34%),
        var(--bg);
    }

    .shell { max-width: 1500px; margin: 0 auto; padding: 20px 18px 28px; }
    .header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 14px; flex-wrap: wrap; }
    .brand { display: flex; align-items: center; gap: 10px; }
    .brand-title { margin: 0; font-family: var(--font-mono); font-size: clamp(1.15rem, 2.2vw, 1.8rem); letter-spacing: .16em; font-weight: 700; color: var(--accent); text-shadow: 0 0 14px rgba(0,161,154,.45); }
    .brand-subtitle { margin: 2px 0 0; font-family: var(--font-mono); font-size: .78rem; color: var(--text-muted); letter-spacing: .08em; }

    .live-dot {
      width: 10px; height: 10px; border-radius: 999px; background: var(--ok);
      box-shadow: 0 0 0 rgba(5,150,105,.6); animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(5,150,105,.55); }
      70% { box-shadow: 0 0 0 12px rgba(5,150,105,0); }
      100% { box-shadow: 0 0 0 0 rgba(5,150,105,0); }
    }

    .header-controls { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .clock { font-family: var(--font-mono); font-size: .85rem; color: var(--text-muted); padding: 8px 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-elev); min-width: 190px; text-align: center; }
    .btn { border: 1px solid var(--border); background: var(--bg-elev); color: var(--text); border-radius: 8px; padding: 8px 12px; font-size: .84rem; font-family: var(--font-mono); cursor: pointer; transition: background .2s ease, border-color .2s ease, transform .2s ease; }
    .btn:hover { border-color: var(--accent); transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }

    .grid { display: grid; gap: 12px; grid-template-columns: repeat(12, minmax(0, 1fr)); }
    .pane { background: linear-gradient(180deg, rgba(255,255,255,.015), transparent), var(--bg-elev); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; transition: border-color .2s ease; }
    .pane:target { border-color: var(--accent); }
    .pane-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; border-bottom: 1px solid var(--border); padding: 12px 14px; background: linear-gradient(90deg, rgba(0,161,154,.08), transparent 65%); }
    .pane-title { margin: 0; font-size: .92rem; letter-spacing: .06em; text-transform: uppercase; font-family: var(--font-mono); }
    .pane-meta { color: var(--text-muted); font-family: var(--font-mono); font-size: .75rem; }
    .pane-body { padding: 14px; }
    .pane.collapsed .pane-body { display: none; }
    .pane.wide { grid-column: span 12; }
    .pane.half { grid-column: span 6; }
    @media (max-width:1080px) { .pane.half { grid-column: span 12; } }

    .agent-grid { display: grid; gap: 12px; grid-template-columns: repeat(3, minmax(0, 1fr)); }
    @media (max-width:980px) { .agent-grid { grid-template-columns: 1fr; } }
    .agent-card { background: var(--bg-soft); border: 1px solid var(--border); border-radius: 10px; padding: 12px; display: grid; gap: 8px; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
    .dot.online { background: var(--ok); }
    .dot.idle { background: var(--warn); }
    .dot.offline { background: var(--bad); }

    .mono { font-family: var(--font-mono); font-size: .84rem; }
    .subtle { color: var(--text-muted); font-size: .82rem; }

    .bar { width: 100%; height: 8px; background: rgba(100,110,130,.25); border: 1px solid var(--border); border-radius: 999px; overflow: hidden; }
    .bar > span { display: block; height: 100%; background: var(--ok); transition: width .35s ease; }
    .bar.warn > span { background: var(--warn); }
    .bar.bad > span { background: var(--bad); }

    table { width: 100%; border-collapse: collapse; font-size: .83rem; }
    th, td { border-bottom: 1px solid var(--border); padding: 8px 7px; text-align: left; vertical-align: top; }
    th { color: var(--text-muted); font-family: var(--font-mono); font-size: .76rem; text-transform: uppercase; letter-spacing: .04em; position: sticky; top: 0; background: var(--bg-elev); z-index: 1; }
    tr.context-warning { background: rgba(217,119,6,.08); }
    tr.context-critical { background: rgba(220,38,38,.10); }

    .badge { border-radius: 999px; padding: 2px 8px; font-size: .74rem; font-family: var(--font-mono); border: 1px solid transparent; white-space: nowrap; }
    .badge.live { background: rgba(5,150,105,.14); color: #1ecf8f; border-color: rgba(5,150,105,.35); }
    .badge.in-progress { background: rgba(59,130,246,.14); color: #65a6ff; border-color: rgba(59,130,246,.35); }
    .badge.testing { background: rgba(245,158,11,.14); color: #f2b84a; border-color: rgba(245,158,11,.35); }
    .badge.queued { background: rgba(148,163,184,.16); color: #d0dae7; border-color: rgba(148,163,184,.3); }
    .badge.success { background: rgba(5,150,105,.14); color: #1ecf8f; border-color: rgba(5,150,105,.35); }
    .badge.fail { background: rgba(220,38,38,.12); color: #ff8f8f; border-color: rgba(220,38,38,.3); }
    .badge.enabled { background: rgba(5,150,105,.14); color: #1ecf8f; border-color: rgba(5,150,105,.35); }
    .badge.disabled { background: rgba(148,163,184,.16); color: #d0dae7; border-color: rgba(148,163,184,.3); }

    .projects-wrap { display: grid; gap: 12px; grid-template-columns: repeat(2, minmax(0, 1fr)); }
    @media (max-width:980px) { .projects-wrap { grid-template-columns: 1fr; } }
    .project-group { background: var(--bg-soft); border: 1px solid var(--border); border-radius: 10px; padding: 10px; display: grid; gap: 9px; }
    .project-group h4 { margin: 0; font-size: .87rem; font-family: var(--font-mono); letter-spacing: .04em; }
    .project-item { border: 1px solid var(--border); border-radius: 8px; padding: 8px; background: rgba(255,255,255,.02); display: grid; gap: 5px; }

    .memory-layout { display: grid; grid-template-columns: minmax(250px, 320px) 1fr; gap: 12px; }
    @media (max-width:1080px) { .memory-layout { grid-template-columns: 1fr; } }
    .panel { border: 1px solid var(--border); border-radius: 10px; background: var(--bg-soft); overflow: hidden; }
    .panel header { padding: 10px 11px; border-bottom: 1px solid var(--border); font-size: .8rem; color: var(--text-muted); font-family: var(--font-mono); }
    .memory-search { width: 100%; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-elev); color: var(--text); padding: 8px 9px; font-size: .84rem; font-family: var(--font-mono); }
    .memory-list { max-height: 340px; overflow: auto; padding: 7px; display: grid; gap: 6px; }
    .memory-item { border: 1px solid var(--border); border-radius: 8px; padding: 8px; cursor: pointer; background: var(--bg-elev); transition: border-color .2s ease, transform .2s ease; }
    .memory-item:hover { border-color: var(--accent); transform: translateY(-1px); }
    .memory-item.active { border-color: var(--accent); background: rgba(0,161,154,.08); }
    .memory-view { padding: 12px; max-height: 430px; overflow: auto; font-size: .88rem; line-height: 1.48; color: var(--text); }
    .memory-view h1, .memory-view h2, .memory-view h3 { font-family: var(--font-mono); margin: 14px 0 8px; color: var(--accent); }
    .memory-view code { font-family: var(--font-mono); font-size: .82rem; background: rgba(124,58,237,.16); padding: 1px 4px; border-radius: 4px; }

    .health-grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 10px; }
    @media (max-width:980px) { .health-grid { grid-template-columns: 1fr; } }

    /* Mobile fixes */
    @media (max-width:600px) {
      body { overflow-x: hidden; }
      .shell { padding: 12px 10px 20px; }
      .header { gap: 8px; }
      .brand-title { letter-spacing: .08em; }
      .clock { min-width: unset; font-size: .75rem; padding: 6px 8px; }
      .controls { gap: 6px; }
      .controls button { padding: 6px 10px; font-size: .7rem; }
      table { font-size: .72rem; display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
      th, td { padding: 6px 8px; white-space: nowrap; }
      .agent-card { padding: 14px; }
      .pane-header { padding: 10px 12px; }
      .pane-body { padding: 10px 12px; }
      .project-card { padding: 10px; }
      .memory-view { font-size: .8rem; }
    }
    .health-card { border: 1px solid var(--border); border-radius: 10px; background: var(--bg-soft); padding: 10px; display: grid; gap: 5px; }
    .health-row { display: flex; justify-content: space-between; gap: 7px; align-items: center; }
    .health-state.running, .health-state.online, .health-state.active, .health-state.valid { color: var(--ok); }
    .health-state.expired, .health-state.degraded { color: var(--warn); }
    .health-state.down, .health-state.invalid { color: var(--bad); }

    .hint { margin-top: 11px; color: var(--text-muted); font-size: .77rem; font-family: var(--font-mono); }
    .flash { animation: flash .7s ease; }
    @keyframes flash { 0% { box-shadow: 0 0 0 0 rgba(0,161,154,.45); } 100% { box-shadow: 0 0 0 16px rgba(0,161,154,0); } }
  </style>
</head>
<body>
  <!-- PASSWORD GATE -->
  <div id="authGate" style="display:flex;align-items:center;justify-content:center;min-height:100vh;background:#0a0a0f;">
    <div style="text-align:center;font-family:var(--font-mono,'Courier New',monospace);">
      <div style="font-size:28px;color:#00a19a;margin-bottom:8px;">♜ NETRUNNER</div>
      <div style="font-size:12px;color:#9aa4b2;margin-bottom:24px;">AUTHENTICATION REQUIRED</div>
      <input id="authInput" type="password" placeholder="Enter access code" autofocus
        style="background:#10131b;border:1px solid #273244;color:#e6edf3;padding:12px 20px;font-size:14px;border-radius:8px;width:240px;text-align:center;font-family:inherit;outline:none;"
        onfocus="this.style.borderColor='#00a19a'" onblur="this.style.borderColor='#273244'">
      <div id="authError" style="color:#dc2626;font-size:11px;margin-top:10px;opacity:0;">Access denied</div>
    </div>
  </div>
  <script>
    // SHA-256 hash of password — not plaintext in source
    const ACCESS_HASH = '10e31a1a787614808db4ab2058dc418225d09a5edfe1dd0001494c523e4ed9ef';
    async function sha256(str) {
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
    }
    const authInput = document.getElementById('authInput');
    const authGate = document.getElementById('authGate');
    const authError = document.getElementById('authError');
    const shell = document.querySelector('.shell');

    // Check saved session
    const allShells = document.querySelectorAll('.shell');
    if (sessionStorage.getItem('netrunner-auth') === 'ok') {
      authGate.style.display = 'none';
      allShells.forEach(s => s.style.display = '');
    } else {
      allShells.forEach(s => s.style.display = 'none');
    }

    authInput.addEventListener('keydown', async (e) => {
      if (e.key === 'Enter') {
        const hash = await sha256(authInput.value);
        if (hash === ACCESS_HASH) {
          sessionStorage.setItem('netrunner-auth', 'ok');
          authGate.style.display = 'none';
          document.querySelectorAll('.shell').forEach(s => s.style.display = '');
        } else {
          authError.style.opacity = '1';
          authInput.value = '';
          setTimeout(() => authError.style.opacity = '0', 2000);
        }
      }
    });
  </script>
  <div class="shell" style="display:none">
    <header class="header">
      <div class="brand">
        <span class="live-dot" aria-hidden="true"></span>
        <div>
          <h1 class="brand-title">NETRUNNER</h1>
          <p class="brand-subtitle">AI OPERATIONS COMMAND CENTER</p>
        </div>
      </div>
      <div class="header-controls">
        <div class="clock" id="clock">--</div>
        <button class="btn" id="refreshBtn" title="Shortcut: r">Refresh</button>
        <button class="btn" id="themeBtn" title="Shortcut: t">Toggle Theme</button>
      </div>
    </header>

    <main class="grid">
      <section class="pane wide" id="module-1">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">1. Agent Status Panel</h2>
            <div class="pane-meta">Desktop, Cloud, and Scout state snapshot</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-1" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="agentPanel"></div>
      </section>

      <section class="pane wide" id="module-2">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">2. Session Monitor</h2>
            <div class="pane-meta">Sorted by context usage descending</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-2" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="sessionPanel"></div>
      </section>

      <section class="pane half" id="module-3">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">3. Cron Dashboard</h2>
            <div class="pane-meta">Scheduled jobs and run outcomes</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-3" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="cronPanel"></div>
      </section>

      <section class="pane half" id="module-6">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">6. System Health</h2>
            <div class="pane-meta">Gateway, auth, and deployment checks</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-6" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="healthPanel"></div>
      </section>

      <section class="pane wide" id="module-4">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">4. Project Tracker</h2>
            <div class="pane-meta">Current tasks by execution lane</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-4" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="projectPanel"></div>
      </section>

      <section class="pane wide" id="module-5">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">5. Memory Vault</h2>
            <div class="pane-meta">Embedded snapshots (file protocol safe)</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-5" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="memoryPanel"></div>
      </section>
    </main>
  </div>

  <script>
    "use strict";
    const CONFIG = {
      mode: "static",
      liveApiBase: "http://localhost:18789/api",
      contextMaxDefault: 200000,
      themeStorageKey: "netrunner-theme"
    };

    const AGENTS = [
      {
        id: "desktop-rook",
        name: "Desktop Rook",
        icon: "ROOK",
        status: "online",
        model: "claude-opus-4-6",
        contextUsed: 148600,
        contextMax: 200000,
        lastActive: "2026-02-13T20:48:00",
        host: "WIN-79G2697J611 (WSL2)"
      },
      {
        id: "cloud-rook",
        name: "Cloud Rook",
        icon: "ROOK",
        status: "online",
        model: "claude-opus-4-6",
        contextUsed: 35000,
        contextMax: 200000,
        lastActive: "2026-02-13T18:29:00",
        host: "rook-247 (138.197.64.68)",
        uptime: "2 days 23h"
      },
      {
        id: "scout",
        name: "Scout",
        icon: "SCOUT",
        status: "idle",
        model: "claude-opus-4-6",
        contextUsed: 200000,
        contextMax: 200000,
        lastRun: "2026-02-13T08:00:00",
        nextRun: "2026-02-14T07:00:00",
        summary: "Context full — session cleanup scheduled 8:30 AM CST."
      },
      {
        id: "signal-engine",
        name: "Signal Engine",
        icon: "SCOUT",
        status: "online",
        model: "Node.js (headless)",
        contextUsed: 0,
        contextMax: 0,
        lastActive: "2026-02-13T20:11:00",
        host: "rook-247 (pm2 · PID 83222)",
        uptime: "Running 24/7"
      }
    ];

    const SESSIONS = [
      {
        label: "Desktop Rook DM",
        type: "DM",
        model: "claude-opus-4-6",
        contextUsed: 148600,
        contextMax: 200000,
        cost: null,
        lastMessage: "2026-02-13T20:48:00",
        channel: "Telegram"
      },
      {
        label: "Scout — Daily Analysis",
        type: "Sub-agent",
        model: "claude-opus-4-6",
        contextUsed: 200000,
        contextMax: 200000,
        cost: null,
        lastMessage: "2026-02-13T08:02:00",
        channel: "Cron"
      },
      {
        label: "Morning Briefing",
        type: "Cron",
        model: "claude-opus-4-6",
        contextUsed: 42275,
        contextMax: 200000,
        cost: null,
        lastMessage: "2026-02-12T07:00:00",
        channel: "Telegram"
      },
      {
        label: "The Rookies (Group)",
        type: "Group",
        model: "claude-opus-4-6",
        contextUsed: 20946,
        contextMax: 200000,
        cost: null,
        lastMessage: "2026-02-13T18:30:00",
        channel: "Telegram"
      }
    ];

    const CRON_JOBS = [
      {
        name: "Trade Log Sync to VPS",
        schedule: "Daily 6:30 AM CST",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-14T06:30:00"
      },
      {
        name: "Scout Session Cleanup",
        schedule: "Daily 8:30 AM CST",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-14T08:30:00"
      },
      {
        name: "Black Hole Voting Reminder",
        schedule: "Wed 4:45 PM CST",
        enabled: true,
        lastRun: "2026-02-12T16:45:00",
        lastResult: "success",
        nextFire: "2026-02-19T16:45:00"
      },
      {
        name: "Signal Engine (pm2)",
        schedule: "Every 30s (VPS)",
        enabled: true,
        lastRun: "2026-02-13T20:11:00",
        lastResult: "success",
        nextFire: null
      },
      {
        name: "Cloud Rook Session Cleanup",
        schedule: "Every 6 hours (VPS)",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-13T23:00:00"
      }
    ];

    const PROJECTS = {
      active: [
        {
          name: "Signal & Scalp Trading Bots",
          status: "live",
          desc: "Live v2 — 14 strategies, 3 TFs, widest SL, no stacking bonuses.",
          updated: "2026-02-13"
        },
        {
          name: "Louisville Replenishment Dashboard",
          status: "in-progress",
          desc: "Ontario→Louisville transfer mgmt. Tier/threshold/pallet system built. Per-SKU thresholds active.",
          updated: "2026-02-13"
        },
        {
          name: "Generation Guide Tool",
          status: "testing",
          desc: "SKU generation transition tool. Waiting on user feedback.",
          updated: "2026-02-13"
        }
      ],
      highPriority: [
        {
          name: "LLM Cost Optimization",
          status: "queued",
          desc: "Research cheaper models for routine tasks. No work started.",
          updated: "2026-02-13"
        },
        {
          name: "Portor Inventory Management",
          status: "in-progress",
          desc: "Notes column added for gen transitions. Needs GCS deploy.",
          updated: "2026-02-13"
        }
      ],
      needsPlanning: [
        {
          name: "Product Cross Tool",
          status: "queued",
          desc: "Ground-up rebuild. Tiered architecture: L1 cache, L2 spec match, L3 LLM search.",
          updated: "2026-02-12"
        }
      ],
      backBurner: [
        {
          name: "Power Track Tool",
          status: "queued",
          desc: "Most complex build. Parked.",
          updated: "2026-02-11"
        },
        {
          name: "Rep Hubs",
          status: "queued",
          desc: "Index file built, paused.",
          updated: "2026-02-11"
        },
        {
          name: "Memory Search / Embedding",
          status: "queued",
          desc: "Deferred — not enough history yet.",
          updated: "2026-02-13"
        }
      ],
      completed: [
        {
          name: "Signal Engine (VPS)",
          status: "live",
          desc: "Headless Node.js signal generator. 14 strategies, Binance API, pm2 managed. Running 24/7 on VPS.",
          updated: "2026-02-13"
        },
        {
          name: "Rook HQ (Pixel Office)",
          status: "live",
          desc: "GBC-style pixel office with 4 agent characters. Built by Codex, walking system by Rook.",
          updated: "2026-02-13"
        },
        {
          name: "Netrunner v2 Command Center",
          status: "live",
          desc: "AI ops dashboard. Built by Codex from Rook's spec. iOS home screen icon added.",
          updated: "2026-02-13"
        },
        {
          name: "Cloud Rook Brain Sync",
          status: "live",
          desc: "SSH push pipeline. Desktop Rook pushes memory/config to VPS directly.",
          updated: "2026-02-13"
        },
        {
          name: "Entry Fingerprint Dedup",
          status: "live",
          desc: "Stopped duplicate trade entries in Signal Desk.",
          updated: "2026-02-13"
        },
        {
          name: "Scalp Lab Deep Analysis",
          status: "live",
          desc: "157 trades analyzed. 47.8% WR, +$406.23, 2.69:1 R:R.",
          updated: "2026-02-13"
        },
        {
          name: "Portor Knowledge Base",
          status: "live",
          desc: "487 products, 5 warehouses, 127 clearance items, all cloud functions mapped.",
          updated: "2026-02-11"
        }
      ]
    };

    const MEMORY_FILES = [
      {
        path: "MEMORY.md",
        size: 4800,
        updated: "2026-02-13T16:06:00",
        content: "# Long-term memory. Identity, hard rules, shortcuts, project status, role division, session management, Google Cloud coordination protocol."
      },
      {
        path: "memory/2026-02-11.md",
        size: 3200,
        updated: "2026-02-11T23:59:00",
        content: "Day 1 — Named Rook. Set up SOUL.md, AGENTS.md, identity files. Built Portor knowledge base. First P&A queries. Desktop organized."
      },
      {
        path: "memory/2026-02-12.md",
        size: 4100,
        updated: "2026-02-12T23:59:00",
        content: "Day 2 — Scalp analysis (168 trades), confidence rebalance, SL flip to widest, auto-export server, Scout created, GitHub auth, Cloud Rook deployed."
      },
      {
        path: "memory/2026-02-13.md",
        size: 3474,
        updated: "2026-02-13T17:18:00",
        content: "Day 3 — Louisville dashboard: tier restructure, gen inheritance, pallet thresholds. Inventory Notes column. Netrunner v2 built by Codex. Cloud Rook: crash recovery, brain sync via SSH, session cleanup cron."
      },
      {
        path: "memory/2026-02-13-evening.md",
        size: 1719,
        updated: "2026-02-13T18:37:00",
        content: "Evening — Cloud Rook brain sync, backup taken, crash recovery, Scout session cleanup cron, Louisville refinements."
      },
      {
        path: "memory/2026-02-13-late.md",
        size: 1798,
        updated: "2026-02-13T20:32:00",
        content: "Signal Engine built (9 files, zero deps, verified on Binance). Netrunner iOS icon. VPS = source of truth for trading data."
      },
      {
        path: "memory/2026-02-13-night.md",
        size: 3084,
        updated: "2026-02-13T20:48:00",
        content: "Signal Engine deployed to VPS via pm2. All 7 Codex findings fixed. Netrunner iOS icon pushed. Macro Knowledge Base started (42 Macro by Darius Dale). Auth = OAuth flat rate."
      },
      {
        path: "memory/louisville-thresholds.md",
        size: 1986,
        updated: "2026-02-13T17:02:00",
        content: "Louisville key thresholds, pallet quantities, rep-requested SKUs, tier system, threshold resolution order."
      },
      {
        path: "memory/portor-cloud-reference.md",
        size: 1989,
        updated: "2026-02-13T16:50:00",
        content: "GCP project details, live site URLs, cloud function triggers, deploy commands, branding reference. Sourced from Cloud Rook's CLAUDE.md."
      },
      {
        path: "memory/cloud-rook-report-2026-02-13.md",
        size: 1969,
        updated: "2026-02-13T16:55:00",
        content: "Cloud Rook's verified work: GCS service account, RHBE fixes, SKU gap analysis, staging URL. Incidents: production overwrite, max_tokens config error."
      },
      {
        path: "memory/portor-knowledge-base.md",
        size: 15000,
        updated: "2026-02-11T22:00:00",
        content: "487 products, 5 warehouses, 127 clearance items, 427 competitor crosses, all cloud function pipelines mapped."
      },
      {
        path: "memory/codex-scalp-strategy-audit.md",
        size: 5500,
        updated: "2026-02-13T10:00:00",
        content: "Codex findings: opening candle skip, Kill Zone mismatch, CHOCH asymmetry, FVG fill rule, EMA R:R gate."
      },
      {
        path: "memory/codex-lumenation-audit.md",
        size: 3800,
        updated: "2026-02-13T09:00:00",
        content: "Codex audit of Lumenation Rep Hub codebase."
      }
    ];

    const SYSTEM_HEALTH = {
      desktopGateway: { label: "Desktop Gateway", status: "running", details: "Port 18789 · WSL2 · 5+ compactions today · Opus (OAuth flat rate)" },
      cloudVPS: { label: "Cloud VPS", status: "online", details: "rook-247 · 138.197.64.68 · Signal Engine running (pm2) · poppler-utils installed" },
      signalEngine: { label: "Signal Engine", status: "running", details: "pm2 managed · PID 83222 · 86MB RAM · Auto-restart on crash · Survives reboot" },
      gcloudAuth: { label: "gcloud Auth", status: "expired", details: "brandon@portorindustry.com — needs gcloud auth login" },
      githubAuth: { label: "GitHub Auth", status: "active", details: "Windows credential-manager via WSL" },
      anthropicAPI: { label: "Anthropic API", status: "active", details: "OAuth token (Max Pro) · claude-opus-4-6 · Flat rate — no per-token billing" },
      deployment: { label: "Last GCS Deploy", status: "expired", details: "Blocked — gcloud auth expired" }
    };

    const DOM = {
      clock: document.getElementById("clock"),
      refreshBtn: document.getElementById("refreshBtn"),
      themeBtn: document.getElementById("themeBtn"),
      agentPanel: document.getElementById("agentPanel"),
      sessionPanel: document.getElementById("sessionPanel"),
      cronPanel: document.getElementById("cronPanel"),
      projectPanel: document.getElementById("projectPanel"),
      memoryPanel: document.getElementById("memoryPanel"),
      healthPanel: document.getElementById("healthPanel")
    };

    function toLocaleTime(value) {
      if (!value) return "N/A";
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) return String(value);
      return date.toLocaleString([], {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
    }

    function percent(used, max) {
      if (!max || max <= 0) return 0;
      return Math.max(0, Math.min(100, (used / max) * 100));
    }

    function contextClass(pct) {
      if (pct >= 90) return "bad";
      if (pct >= 70) return "warn";
      return "";
    }

    function money(value) {
      return "$" + Number(value || 0).toFixed(2);
    }

    function escapeHtml(text) {
      return String(text)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;");
    }

    function renderMarkdown(md) {
      let html = escapeHtml(md);
      html = html.replace(/^### (.+)$/gm, "<h3>$1</h3>");
      html = html.replace(/^## (.+)$/gm, "<h2>$1</h2>");
      html = html.replace(/^# (.+)$/gm, "<h1>$1</h1>");
      html = html.replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>");
      html = html.replace(/`([^`]+)`/g, "<code>$1</code>");
      html = html.replace(/^- (.+)$/gm, "<li>$1</li>");
      html = html.replace(/(<li>.*<\/li>)/gs, "<ul>$1</ul>");
      html = html.replace(/\n{2,}/g, "</p><p>");
      html = "<p>" + html + "</p>";
      html = html.replace(/<p><h/g, "<h").replace(/<\/h([1-3])><\/p>/g, "</h$1>");
      html = html.replace(/<p><ul>/g, "<ul>").replace(/<\/ul><\/p>/g, "</ul>");
      return html;
    }

    function renderAgents() {
      const cards = AGENTS.map((agent) => {
        const used = agent.contextUsed || 0;
        const max = agent.contextMax || CONFIG.contextMaxDefault;
        const pct = percent(used, max);
        const barClass = contextClass(pct);
        const extra = agent.id === "scout"
          ? `<div class="subtle">Last run: ${toLocaleTime(agent.lastRun)}<br>Next run: ${toLocaleTime(agent.nextRun)}<br>${escapeHtml(agent.summary || "")}</div>`
          : `<div class="subtle">Host: ${escapeHtml(agent.host || "N/A")} ${agent.uptime ? "<br>Uptime: " + escapeHtml(agent.uptime) : ""}</div>`;

        return `
          <article class="agent-card">
            <div class="row">
              <div class="mono"><strong>${escapeHtml(agent.icon)} ${escapeHtml(agent.name)}</strong></div>
              <span class="dot ${escapeHtml(agent.status)}" title="${escapeHtml(agent.status)}"></span>
            </div>
            <div class="subtle">Model: <span class="mono">${escapeHtml(agent.model || "N/A")}</span></div>
            <div class="row mono"><span>Context</span><span>${used.toLocaleString()} / ${max.toLocaleString()} (${pct.toFixed(1)}%)</span></div>
            <div class="bar ${barClass}"><span style="width:${pct.toFixed(1)}%"></span></div>
            <div class="subtle">Last active: ${toLocaleTime(agent.lastActive || agent.lastRun)}</div>
            ${extra}
          </article>`;
      }).join("");

      DOM.agentPanel.innerHTML = `<div class="agent-grid">${cards}</div><div class="hint">Shortcut: press 1 to jump here.</div>`;
    }
    function renderSessions() {
      const sorted = [...SESSIONS].sort((a, b) => percent(b.contextUsed, b.contextMax) - percent(a.contextUsed, a.contextMax));
      const rows = sorted.map((session) => {
        const pct = percent(session.contextUsed, session.contextMax);
        const rowClass = pct >= 90 ? "context-critical" : pct >= 70 ? "context-warning" : "";
        const barClass = contextClass(pct);
        return `
          <tr class="${rowClass}">
            <td class="mono">${escapeHtml(session.label)}</td>
            <td>${escapeHtml(session.type)}</td>
            <td class="mono">${escapeHtml(session.model)}</td>
            <td>
              <div class="mono">${session.contextUsed.toLocaleString()} / ${session.contextMax.toLocaleString()} (${pct.toFixed(1)}%)</div>
              <div class="bar ${barClass}" style="margin-top:5px;"><span style="width:${pct.toFixed(1)}%"></span></div>
            </td>
            <td class="mono">${money(session.cost)}</td>
            <td class="mono">${toLocaleTime(session.lastMessage)}</td>
            <td>${escapeHtml(session.channel)}</td>
          </tr>`;
      }).join("");

      DOM.sessionPanel.innerHTML = `
        <div style="max-height:360px; overflow:auto;">
          <table>
            <thead>
              <tr>
                <th>Session</th>
                <th>Type</th>
                <th>Model</th>
                <th>Context</th>
                <th>Cost</th>
                <th>Last Message</th>
                <th>Channel</th>
              </tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
        </div>
        <div class="hint">Shortcut: press 2 to jump here. Rows are highlighted above 70%/90% context use.</div>`;
    }

    function renderCron() {
      const rows = CRON_JOBS.map((job) => `
        <tr>
          <td>${escapeHtml(job.name)}</td>
          <td class="mono">${escapeHtml(job.schedule)}</td>
          <td><span class="badge ${job.enabled ? "enabled" : "disabled"}">${job.enabled ? "Enabled" : "Disabled"}</span></td>
          <td class="mono">${toLocaleTime(job.lastRun)}<br><span class="badge ${job.lastResult === "success" ? "success" : "fail"}">${escapeHtml(job.lastResult)}</span></td>
          <td class="mono">${toLocaleTime(job.nextFire)}</td>
        </tr>`).join("");

      DOM.cronPanel.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Job</th>
              <th>Schedule</th>
              <th>Status</th>
              <th>Last Run</th>
              <th>Next Fire</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <div class="hint">Shortcut: press 3 to jump here.</div>`;
    }

    function projectCard(item) {
      return `
        <article class="project-item">
          <div class="row">
            <strong>${escapeHtml(item.name)}</strong>
            <span class="badge ${escapeHtml(item.status)}">${escapeHtml(item.status)}</span>
          </div>
          <div class="subtle">${escapeHtml(item.desc)}</div>
          <div class="mono subtle">Updated: ${escapeHtml(item.updated)}</div>
        </article>`;
    }

    function renderProjectGroup(title, items) {
      return `
        <section class="project-group">
          <h4>${escapeHtml(title)}</h4>
          ${items.length ? items.map(projectCard).join("") : "<div class='subtle'>No items</div>"}
        </section>`;
    }

    function renderProjects() {
      DOM.projectPanel.innerHTML = `
        <div class="projects-wrap">
          ${renderProjectGroup("Active Projects", PROJECTS.active)}
          ${renderProjectGroup("High Priority", PROJECTS.highPriority)}
          ${renderProjectGroup("Needs Planning", PROJECTS.needsPlanning)}
          ${renderProjectGroup("Back Burner", PROJECTS.backBurner)}
        </div>
        <details style="margin-top:10px;">
          <summary class="mono" style="cursor:pointer;">Completed</summary>
          <div style="margin-top:8px;">
            ${PROJECTS.completed.map(projectCard).join("")}
          </div>
        </details>
        <div class="hint">Shortcut: press 4 to jump here.</div>`;
    }

    function renderMemoryList(filtered, activePath) {
      return filtered.map((file) => `
        <article class="memory-item ${file.path === activePath ? "active" : ""}" data-path="${escapeHtml(file.path)}">
          <div class="mono"><strong>${escapeHtml(file.path)}</strong></div>
          <div class="subtle">${file.size.toLocaleString()} bytes</div>
          <div class="subtle">${toLocaleTime(file.updated)}</div>
        </article>`).join("");
    }

    function renderMemory() {
      let activePath = MEMORY_FILES[0] ? MEMORY_FILES[0].path : "";
      let query = "";

      DOM.memoryPanel.innerHTML = `
        <div class="memory-layout">
          <section class="panel">
            <header>
              <div>File Search</div>
              <div style="margin-top:8px;"><input class="memory-search" id="memorySearch" placeholder="Search file name or content..." /></div>
            </header>
            <div class="memory-list" id="memoryList"></div>
          </section>
          <section class="panel">
            <header id="memoryTitle">Preview</header>
            <div class="memory-view" id="memoryView">Select a file to view contents.</div>
          </section>
        </div>
        <div class="hint">Shortcut: press 5 to jump here. Static snapshot mode is active.</div>`;

      const searchEl = document.getElementById("memorySearch");
      const listEl = document.getElementById("memoryList");
      const viewEl = document.getElementById("memoryView");
      const titleEl = document.getElementById("memoryTitle");

      function matchingFiles() {
        const needle = query.trim().toLowerCase();
        if (!needle) return MEMORY_FILES;
        return MEMORY_FILES.filter((file) => {
          return file.path.toLowerCase().includes(needle) || file.content.toLowerCase().includes(needle);
        });
      }

      function renderDetail() {
        const files = matchingFiles();
        if (!files.find((f) => f.path === activePath) && files[0]) {
          activePath = files[0].path;
        }
        listEl.innerHTML = renderMemoryList(files, activePath);
        const active = MEMORY_FILES.find((f) => f.path === activePath);
        if (!active) {
          titleEl.textContent = "Preview";
          viewEl.textContent = "No files match the current search.";
          return;
        }
        titleEl.textContent = `${active.path} - ${active.size.toLocaleString()} bytes`;
        viewEl.innerHTML = renderMarkdown(active.content);
      }

      searchEl.addEventListener("input", () => {
        query = searchEl.value || "";
        renderDetail();
      });

      listEl.addEventListener("click", (event) => {
        const target = event.target.closest(".memory-item");
        if (!target) return;
        activePath = target.getAttribute("data-path") || activePath;
        renderDetail();
      });

      renderDetail();
    }

    function renderHealth() {
      const rows = Object.values(SYSTEM_HEALTH).map((item) => `
        <article class="health-card">
          <div class="health-row">
            <strong>${escapeHtml(item.label)}</strong>
            <span class="mono health-state ${escapeHtml(item.status)}">${escapeHtml(item.status)}</span>
          </div>
          <div class="subtle">${escapeHtml(item.details)}</div>
        </article>`).join("");

      DOM.healthPanel.innerHTML = `
        <div class="health-grid">${rows}</div>
        <div class="hint">Shortcut: press 6 to jump here.</div>`;
    }

    function renderAllPanels() {
      renderAgents();
      renderSessions();
      renderCron();
      renderProjects();
      renderMemory();
      renderHealth();
    }
    async function refreshData() {
      if (CONFIG.mode === "live") {
        // Live mode hook for future API integration.
      }
      renderAllPanels();
      document.body.classList.add("flash");
      setTimeout(() => document.body.classList.remove("flash"), 700);
    }

    function setTheme(theme) {
      const safeTheme = theme === "light" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", safeTheme);
      localStorage.setItem(CONFIG.themeStorageKey, safeTheme);
    }

    function initTheme() {
      const saved = localStorage.getItem(CONFIG.themeStorageKey);
      if (saved === "light" || saved === "dark") {
        setTheme(saved);
      } else {
        setTheme("dark");
      }
    }

    function setupClock() {
      function tick() {
        DOM.clock.textContent = new Date().toLocaleString([], {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit"
        });
      }
      tick();
      setInterval(tick, 1000);
    }

    function togglePane(paneId) {
      const pane = document.getElementById(paneId);
      if (!pane) return;
      pane.classList.toggle("collapsed");
      const button = pane.querySelector(".collapse-btn");
      if (button) {
        const expanded = !pane.classList.contains("collapsed");
        button.setAttribute("aria-expanded", expanded ? "true" : "false");
        button.textContent = expanded ? "Collapse" : "Expand";
      }
    }

    function jumpToModule(index) {
      const target = document.getElementById(`module-${index}`);
      if (!target) return;
      target.scrollIntoView({ behavior: "smooth", block: "start" });
      target.classList.add("flash");
      setTimeout(() => target.classList.remove("flash"), 700);
    }

    function bindEvents() {
      DOM.refreshBtn.addEventListener("click", refreshData);
      DOM.themeBtn.addEventListener("click", () => {
        const next = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
        setTheme(next);
      });

      document.querySelectorAll(".collapse-btn").forEach((button) => {
        button.addEventListener("click", () => togglePane(button.getAttribute("data-pane")));
      });

      document.addEventListener("keydown", (event) => {
        if (event.target && (event.target.tagName === "INPUT" || event.target.tagName === "TEXTAREA")) {
          return;
        }
        const key = event.key.toLowerCase();
        if (["1", "2", "3", "4", "5", "6"].includes(key)) {
          jumpToModule(key);
        } else if (key === "r") {
          refreshData();
        } else if (key === "t") {
          const next = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
          setTheme(next);
        }
      });
    }

    function init() {
      initTheme();
      setupClock();
      renderAllPanels();
      bindEvents();
    }

    init();
  </script>
</body>
</html>

