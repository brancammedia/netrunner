<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Netrunner">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/svg+xml" href="apple-touch-icon.svg">
  <title>Netrunner v2 - AI Operations Command Center</title>
  <style>
    :root {
      --bg: #0a0a0f;
      --bg-elev: #10131b;
      --bg-soft: #161b24;
      --text: #e6edf3;
      --text-muted: #9aa4b2;
      --border: #273244;
      --accent: #00a19a;
      --ok: #059669;
      --warn: #d97706;
      --bad: #dc2626;
      --special: #7c3aed;
      --shadow: 0 16px 40px rgba(0, 0, 0, 0.35);
      --radius: 12px;
      --font-mono: "JetBrains Mono", "Fira Code", Consolas, "Courier New", monospace;
      --font-ui: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    html[data-theme="light"] {
      --bg: #f3f6fb;
      --bg-elev: #ffffff;
      --bg-soft: #edf2f8;
      --text: #141a22;
      --text-muted: #4e5b6b;
      --border: #c8d2df;
      --accent: #007c76;
      --ok: #0d8a58;
      --warn: #a76608;
      --bad: #b21f2d;
      --special: #6435d8;
      --shadow: 0 12px 28px rgba(34, 42, 55, 0.12);
    }

    * { box-sizing: border-box; }
    html, body { overflow-x: hidden; max-width: 100vw; }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: var(--font-ui);
      background:
        radial-gradient(circle at 10% 10%, rgba(0, 161, 154, 0.13), transparent 32%),
        radial-gradient(circle at 90% 20%, rgba(124, 58, 237, 0.1), transparent 34%),
        var(--bg);
    }

    .shell { max-width: 1500px; margin: 0 auto; padding: 20px 18px 28px; overflow-x: hidden; box-sizing: border-box; }
    .header { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 14px; flex-wrap: wrap; }
    .brand { display: flex; align-items: center; gap: 10px; }
    .brand-title { margin: 0; font-family: var(--font-mono); font-size: clamp(1.15rem, 2.2vw, 1.8rem); letter-spacing: .16em; font-weight: 700; color: var(--accent); text-shadow: 0 0 14px rgba(0,161,154,.45); }
    .brand-subtitle { margin: 2px 0 0; font-family: var(--font-mono); font-size: .78rem; color: var(--text-muted); letter-spacing: .08em; }

    .live-dot {
      width: 10px; height: 10px; border-radius: 999px; background: var(--ok);
      box-shadow: 0 0 0 rgba(5,150,105,.6); animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(5,150,105,.55); }
      70% { box-shadow: 0 0 0 12px rgba(5,150,105,0); }
      100% { box-shadow: 0 0 0 0 rgba(5,150,105,0); }
    }

    .header-controls { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .clock { font-family: var(--font-mono); font-size: .85rem; color: var(--text-muted); padding: 8px 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-elev); min-width: 190px; text-align: center; }
    .btn { border: 1px solid var(--border); background: var(--bg-elev); color: var(--text); border-radius: 8px; padding: 8px 12px; font-size: .84rem; font-family: var(--font-mono); cursor: pointer; transition: background .2s ease, border-color .2s ease, transform .2s ease; }
    .btn:hover { border-color: var(--accent); transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }

    .grid { display: grid; gap: 12px; grid-template-columns: repeat(12, minmax(0, 1fr)); }
    .pane { background: linear-gradient(180deg, rgba(255,255,255,.015), transparent), var(--bg-elev); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; transition: border-color .2s ease; }
    .pane:target { border-color: var(--accent); }
    .pane-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; border-bottom: 1px solid var(--border); padding: 12px 14px; background: linear-gradient(90deg, rgba(0,161,154,.08), transparent 65%); }
    .pane-title { margin: 0; font-size: .92rem; letter-spacing: .06em; text-transform: uppercase; font-family: var(--font-mono); }
    .pane-meta { color: var(--text-muted); font-family: var(--font-mono); font-size: .75rem; }
    .pane-body { padding: 14px; }
    .pane.collapsed .pane-body { display: none; }
    .pane.wide { grid-column: span 12; }
    .pane.half { grid-column: span 6; }
    @media (max-width:1080px) { .pane.half { grid-column: span 12; } }

    .agent-grid { display: grid; gap: 12px; grid-template-columns: repeat(3, minmax(0, 1fr)); }
    @media (max-width:980px) { .agent-grid { grid-template-columns: 1fr; } }
    .agent-card { background: var(--bg-soft); border: 1px solid var(--border); border-radius: 10px; padding: 12px; display: grid; gap: 8px; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
    .dot.online { background: var(--ok); }
    .dot.idle { background: var(--warn); }
    .dot.offline { background: var(--bad); }

    .mono { font-family: var(--font-mono); font-size: .84rem; }
    .subtle { color: var(--text-muted); font-size: .82rem; }

    .bar { width: 100%; height: 8px; background: rgba(100,110,130,.25); border: 1px solid var(--border); border-radius: 999px; overflow: hidden; }
    .bar > span { display: block; height: 100%; background: var(--ok); transition: width .35s ease; }
    .bar.warn > span { background: var(--warn); }
    .bar.bad > span { background: var(--bad); }

    table { width: 100%; border-collapse: collapse; font-size: .83rem; }
    th, td { border-bottom: 1px solid var(--border); padding: 8px 7px; text-align: left; vertical-align: top; }
    th { color: var(--text-muted); font-family: var(--font-mono); font-size: .76rem; text-transform: uppercase; letter-spacing: .04em; position: sticky; top: 0; background: var(--bg-elev); z-index: 1; }
    tr.context-warning { background: rgba(217,119,6,.08); }
    tr.context-critical { background: rgba(220,38,38,.10); }

    .badge { border-radius: 999px; padding: 2px 8px; font-size: .74rem; font-family: var(--font-mono); border: 1px solid transparent; white-space: nowrap; }
    .badge.live { background: rgba(5,150,105,.14); color: #1ecf8f; border-color: rgba(5,150,105,.35); }
    .badge.in-progress { background: rgba(59,130,246,.14); color: #65a6ff; border-color: rgba(59,130,246,.35); }
    .badge.testing { background: rgba(245,158,11,.14); color: #f2b84a; border-color: rgba(245,158,11,.35); }
    .badge.queued { background: rgba(148,163,184,.16); color: #d0dae7; border-color: rgba(148,163,184,.3); }
    .badge.success { background: rgba(5,150,105,.14); color: #1ecf8f; border-color: rgba(5,150,105,.35); }
    .badge.fail { background: rgba(220,38,38,.12); color: #ff8f8f; border-color: rgba(220,38,38,.3); }
    .badge.enabled { background: rgba(5,150,105,.14); color: #1ecf8f; border-color: rgba(5,150,105,.35); }
    .badge.disabled { background: rgba(148,163,184,.16); color: #d0dae7; border-color: rgba(148,163,184,.3); }

    .projects-wrap { display: grid; gap: 12px; grid-template-columns: repeat(2, minmax(0, 1fr)); }
    @media (max-width:980px) { .projects-wrap { grid-template-columns: 1fr; } }
    .project-group { background: var(--bg-soft); border: 1px solid var(--border); border-radius: 10px; padding: 10px; display: grid; gap: 9px; }
    .project-group h4 { margin: 0; font-size: .87rem; font-family: var(--font-mono); letter-spacing: .04em; }
    .project-item { border: 1px solid var(--border); border-radius: 8px; padding: 8px; background: rgba(255,255,255,.02); display: grid; gap: 5px; }

    .memory-layout { display: grid; grid-template-columns: minmax(250px, 320px) 1fr; gap: 12px; }
    @media (max-width:1080px) { .memory-layout { grid-template-columns: 1fr; } }
    .panel { border: 1px solid var(--border); border-radius: 10px; background: var(--bg-soft); overflow: hidden; }
    .panel header { padding: 10px 11px; border-bottom: 1px solid var(--border); font-size: .8rem; color: var(--text-muted); font-family: var(--font-mono); }
    .memory-search { width: 100%; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-elev); color: var(--text); padding: 8px 9px; font-size: .84rem; font-family: var(--font-mono); }
    .memory-list { max-height: 340px; overflow: auto; padding: 7px; display: grid; gap: 6px; }
    .memory-item { border: 1px solid var(--border); border-radius: 8px; padding: 8px; cursor: pointer; background: var(--bg-elev); transition: border-color .2s ease, transform .2s ease; }
    .memory-item:hover { border-color: var(--accent); transform: translateY(-1px); }
    .memory-item.active { border-color: var(--accent); background: rgba(0,161,154,.08); }
    .memory-view { padding: 12px; max-height: 430px; overflow: auto; font-size: .88rem; line-height: 1.48; color: var(--text); }
    .memory-view h1, .memory-view h2, .memory-view h3 { font-family: var(--font-mono); margin: 14px 0 8px; color: var(--accent); }
    .memory-view code { font-family: var(--font-mono); font-size: .82rem; background: rgba(124,58,237,.16); padding: 1px 4px; border-radius: 4px; }

    .health-grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 10px; }
    @media (max-width:980px) { .health-grid { grid-template-columns: 1fr; } }

    /* Mobile fixes ‚Äî comprehensive */
    @media (max-width:768px) {
      body { overflow-x: hidden; max-width: 100vw; }
      .shell { padding: 12px 8px 20px; max-width: 100vw; overflow-x: hidden; box-sizing: border-box; }
      .header { gap: 6px; flex-wrap: wrap; }
      .brand-title { letter-spacing: .06em; font-size: .85rem; }
      .clock { min-width: unset; font-size: .72rem; padding: 5px 7px; }
      .controls { gap: 4px; }
      .controls button { padding: 5px 8px; font-size: .68rem; }
      .grid { grid-template-columns: 1fr !important; }
      .pane.half { grid-column: span 1 !important; }
      .pane.wide { grid-column: span 1 !important; }
      .agent-grid { grid-template-columns: 1fr !important; }
      .health-grid { grid-template-columns: 1fr !important; }
      .projects-wrap { grid-template-columns: 1fr !important; }
      .memory-layout { grid-template-columns: 1fr !important; }
      table { font-size: .7rem; display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; max-width: calc(100vw - 40px); }
      th, td { padding: 5px 6px; white-space: nowrap; }
      .agent-card { padding: 12px; }
      .pane-header { padding: 8px 10px; }
      .pane-body { padding: 8px 10px; overflow-x: auto; }
      .pane-title { font-size: .8rem; }
      .pane-meta { font-size: .68rem; }
      .project-card { padding: 8px; }
      .memory-view { font-size: .78rem; padding: 8px; }
      .memory-list { max-height: 240px; }
      .bar-label { font-size: .68rem; }
    }
    @media (max-width:420px) {
      .shell { padding: 8px 5px 16px; }
      .brand-title { font-size: .75rem; }
      .clock { font-size: .65rem; padding: 4px 6px; }
      .agent-card { padding: 10px; }
      table { font-size: .62rem; }
      th, td { padding: 4px 5px; }
    }
    .health-card { border: 1px solid var(--border); border-radius: 10px; background: var(--bg-soft); padding: 10px; display: grid; gap: 5px; }
    .health-row { display: flex; justify-content: space-between; gap: 7px; align-items: center; }
    .health-state.running, .health-state.online, .health-state.active, .health-state.valid { color: var(--ok); }
    .health-state.expired, .health-state.degraded { color: var(--warn); }
    .health-state.down, .health-state.invalid { color: var(--bad); }

    .hint { margin-top: 11px; color: var(--text-muted); font-size: .77rem; font-family: var(--font-mono); }
    .flash { animation: flash .7s ease; }
    @keyframes flash { 0% { box-shadow: 0 0 0 0 rgba(0,161,154,.45); } 100% { box-shadow: 0 0 0 16px rgba(0,161,154,0); } }
  </style>
</head>
<body>
  <!-- PASSWORD GATE -->
  <div id="authGate" style="display:flex;align-items:center;justify-content:center;min-height:100vh;background:#0a0a0f;">
    <div style="text-align:center;font-family:var(--font-mono,'Courier New',monospace);">
      <div style="font-size:28px;color:#00a19a;margin-bottom:8px;">‚ôú NETRUNNER</div>
      <div style="font-size:12px;color:#9aa4b2;margin-bottom:24px;">AUTHENTICATION REQUIRED</div>
      <input id="authInput" type="password" placeholder="Enter access code" autofocus
        style="background:#10131b;border:1px solid #273244;color:#e6edf3;padding:12px 20px;font-size:14px;border-radius:8px;width:240px;text-align:center;font-family:inherit;outline:none;"
        onfocus="this.style.borderColor='#00a19a'" onblur="this.style.borderColor='#273244'">
      <div id="authError" style="color:#dc2626;font-size:11px;margin-top:10px;opacity:0;">Access denied</div>
    </div>
  </div>
  <script>
    // SHA-256 hash of password ‚Äî not plaintext in source
    const ACCESS_HASH = '555c74e9d3780f5507c2857a599bf038c5865285be94367b8b7559b801138029';
    async function sha256(str) {
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
    }
    const authInput = document.getElementById('authInput');
    const authGate = document.getElementById('authGate');
    const authError = document.getElementById('authError');
    const shell = document.querySelector('.shell');

    // Check saved session
    const allShells = document.querySelectorAll('.shell');
    if (sessionStorage.getItem('netrunner-auth') === 'ok') {
      authGate.style.display = 'none';
      allShells.forEach(s => s.style.display = '');
    } else {
      allShells.forEach(s => s.style.display = 'none');
    }

    authInput.addEventListener('keydown', async (e) => {
      if (e.key === 'Enter') {
        const hash = await sha256(authInput.value);
        if (hash === ACCESS_HASH) {
          sessionStorage.setItem('netrunner-auth', 'ok');
          authGate.style.display = 'none';
          document.querySelectorAll('.shell').forEach(s => s.style.display = '');
        } else {
          authError.style.opacity = '1';
          authInput.value = '';
          setTimeout(() => authError.style.opacity = '0', 2000);
        }
      }
    });
  </script>
  <div class="shell" style="display:none">
    <header class="header">
      <div class="brand">
        <span class="live-dot" aria-hidden="true"></span>
        <div>
          <h1 class="brand-title">NETRUNNER</h1>
          <p class="brand-subtitle">AI OPERATIONS COMMAND CENTER</p>
        </div>
      </div>
      <div class="header-controls">
        <div class="clock" id="clock">--</div>
        <button class="btn" id="refreshBtn" title="Shortcut: r">Refresh</button>
        <button class="btn" id="themeBtn" title="Shortcut: t">Toggle Theme</button>
      </div>
    </header>

    <main class="grid">
      <section class="pane wide" id="module-1">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">1. Agent Status Panel</h2>
            <div class="pane-meta">Desktop, Cloud, and Scout state snapshot</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-1" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="agentPanel"></div>
      </section>

      <section class="pane wide" id="module-2">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">2. Session Monitor</h2>
            <div class="pane-meta">Sorted by context usage descending</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-2" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="sessionPanel"></div>
      </section>

      <section class="pane half" id="module-3">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">3. Cron Dashboard</h2>
            <div class="pane-meta">Scheduled jobs and run outcomes</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-3" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="cronPanel"></div>
      </section>

      <section class="pane half" id="module-6">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">6. System Health</h2>
            <div class="pane-meta">Gateway, auth, and deployment checks</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-6" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="healthPanel"></div>
      </section>

      <section class="pane wide" id="module-4">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">4. Project Tracker</h2>
            <div class="pane-meta">Current tasks by execution lane</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-4" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="projectPanel"></div>
      </section>

      <section class="pane wide" id="module-5">
        <div class="pane-header">
          <div>
            <h2 class="pane-title">5. Memory Vault</h2>
            <div class="pane-meta">Embedded snapshots (file protocol safe)</div>
          </div>
          <button class="btn collapse-btn" data-pane="module-5" aria-expanded="true">Collapse</button>
        </div>
        <div class="pane-body" id="memoryPanel"></div>
      </section>
    </main>
  </div>

  <script>
    "use strict";
    const CONFIG = {
      mode: "static",
      liveApiBase: "http://localhost:18789/api",
      contextMaxDefault: 200000,
      themeStorageKey: "netrunner-theme"
    };

    const AGENTS = [
      {
        id: "rook",
        name: "Rook ‚ôú",
        icon: "ROOK",
        status: "online",
        model: "claude-opus-4-6",
        contextUsed: 0,
        contextMax: 200000,
        lastActive: "2026-02-24T01:00:00",
        host: "rook-247 (138.197.64.68)",
        uptime: "24/7 VPS"
      },
      {
        id: "dunk",
        name: "Dunk ‚ôû",
        icon: "ROOK",
        status: "standby",
        model: "claude-opus-4-6",
        contextUsed: 0,
        contextMax: 200000,
        lastActive: "2026-02-23T21:00:00",
        host: "rook-247 (sub-agent)",
        summary: "Memory backed up. Available as sub-agent for reviews & audits."
      },
      {
        id: "scout",
        name: "Scout ‚ôüÔ∏è",
        icon: "SCOUT",
        status: "online",
        model: "claude-sonnet-4-6",
        contextUsed: 0,
        contextMax: 200000,
        lastRun: "2026-02-24T05:00:00",
        nextRun: "2026-02-24T17:00:00",
        summary: "Data analyst. Runs 2x/day in Engine Optimization pipeline."
      },
      {
        id: "signal-engine",
        name: "Signal Engine",
        icon: "SCOUT",
        status: "online",
        model: "Node.js (headless)",
        contextUsed: 0,
        contextMax: 0,
        lastActive: "2026-02-24T01:00:00",
        host: "rook-247 (pm2)",
        uptime: "Continuous"
      }
    ];

    const SESSIONS = [
      {
        label: "Desktop Rook DM",
        type: "DM",
        model: "claude-opus-4-6",
        contextUsed: 41933,
        contextMax: 200000,
        cost: 0.22,
        lastMessage: "2026-02-23T02:01:00",
        channel: "Telegram"
      },
      {
        label: "Netrunner Nightly Refresh",
        type: "Cron",
        model: "claude-opus-4-6",
        contextUsed: 0,
        contextMax: 200000,
        cost: 0.00,
        lastMessage: "2026-02-23T03:00:00",
        channel: "Cron"
      },
      {
        label: "Rook's Gambit",
        type: "Cron",
        model: "claude-opus-4-6",
        contextUsed: 23181,
        contextMax: 200000,
        cost: 0.02,
        lastMessage: "2026-02-22T07:30:00",
        channel: "Cron"
      },
      {
        label: "BTC Market Analysis",
        type: "Cron",
        model: "claude-opus-4-6",
        contextUsed: 19758,
        contextMax: 200000,
        cost: 0.02,
        lastMessage: "2026-02-22T07:00:00",
        channel: "Cron"
      },
      {
        label: "Portor Health Check",
        type: "Cron",
        model: "claude-opus-4-6",
        contextUsed: 29683,
        contextMax: 200000,
        cost: 0.02,
        lastMessage: "2026-02-19T15:30:00",
        channel: "Cron"
      },
      {
        label: "The Rookies (Group)",
        type: "Group",
        model: "claude-opus-4-6",
        contextUsed: 23643,
        contextMax: 200000,
        cost: null,
        lastMessage: "2026-02-16T18:45:00",
        channel: "Telegram"
      }
    ];

    const CRON_JOBS = [
      {
        name: "Engine Opt ‚Äî AM Step 1: Data Analysis (Scout)",
        schedule: "Daily 5:00 AM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T05:00:00"
      },
      {
        name: "Engine Opt ‚Äî AM Step 2: Propose Changes (Rook)",
        schedule: "Daily 5:20 AM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T05:20:00"
      },
      {
        name: "Engine Opt ‚Äî AM Step 3: Review Proposal (Dunk)",
        schedule: "Daily 5:40 AM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T05:40:00"
      },
      {
        name: "Engine Opt ‚Äî AM Step 4: Implement Changes (Rook)",
        schedule: "Daily 6:00 AM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T06:00:00"
      },
      {
        name: "Engine Opt ‚Äî AM Step 5: Code Audit (Dunk)",
        schedule: "Daily 6:20 AM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T06:20:00"
      },
      {
        name: "Engine Opt ‚Äî AM Step 6: Fix Audit Issues (Rook)",
        schedule: "Daily 6:40 AM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T06:40:00"
      },
      {
        name: "Engine Opt ‚Äî Morning Report",
        schedule: "Daily 7:00 AM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T07:00:00"
      },
      {
        name: "Morning Briefing - Gosey",
        schedule: "Daily 7:30 AM CT",
        enabled: true,
        lastRun: "2026-02-23T07:30:00",
        lastResult: "success",
        nextFire: "2026-02-24T07:30:00"
      },
      {
        name: "Portor Health Check",
        schedule: "Daily 7:30 AM CT",
        enabled: true,
        lastRun: "2026-02-23T13:30:00",
        lastResult: "success",
        nextFire: "2026-02-24T13:30:00"
      },
      {
        name: "Engine Opt ‚Äî PM Step 1: Data Analysis (Scout)",
        schedule: "Daily 5:00 PM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T17:00:00"
      },
      {
        name: "Engine Opt ‚Äî PM Step 2: Propose Changes (Rook)",
        schedule: "Daily 5:20 PM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T17:20:00"
      },
      {
        name: "Engine Opt ‚Äî PM Step 3: Review Proposal (Dunk)",
        schedule: "Daily 5:40 PM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T17:40:00"
      },
      {
        name: "Engine Opt ‚Äî PM Step 4: Implement Changes (Rook)",
        schedule: "Daily 6:00 PM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T18:00:00"
      },
      {
        name: "Engine Opt ‚Äî PM Step 5: Code Audit (Dunk)",
        schedule: "Daily 6:20 PM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T18:20:00"
      },
      {
        name: "Engine Opt ‚Äî PM Step 6: Fix Audit Issues (Rook)",
        schedule: "Daily 6:40 PM CT",
        enabled: true,
        lastRun: null,
        lastResult: null,
        nextFire: "2026-02-24T18:40:00"
      },
      {
        name: "Session Cleanup",
        schedule: "Every 6h",
        enabled: true,
        lastRun: "2026-02-23T18:00:00",
        lastResult: "success",
        nextFire: "2026-02-24T00:00:00"
      },
      {
        name: "Signal Engine (pm2)",
        schedule: "Continuous (VPS)",
        enabled: true,
        lastRun: "2026-02-24T01:00:00",
        lastResult: "success",
        nextFire: null
      },
      {
        name: "Inventory Refresh (Local)",
        schedule: "Daily 7:45 AM ET (system cron)",
        enabled: true,
        lastRun: "2026-02-23T21:19:00",
        lastResult: "success",
        nextFire: "2026-02-24T12:45:00"
      }
    ];

    const PROJECTS = {
      active: [
        {
          name: "Signal Engine + Optimization Pipeline",
          status: "live",
          tag: "üîÑ AUTONOMOUS",
          desc: "352-trade audit ‚Üí 6 fixes deployed Feb 23. Autonomous 2x/day optimization pipeline: Scout‚ÜíRook‚ÜíDunk‚ÜíRook‚ÜíDunk‚ÜíRook. 7 profitable strategies, single-TF only.",
          updated: "2026-02-23"
        },
        {
          name: "Portor Inventory Management",
          status: "live",
          desc: "Max Lumens column. 563 products. Local refresh cron 7:45 AM ET. Cloud function 7:30 AM EST.",
          updated: "2026-02-23"
        },
        {
          name: "Portor P&A Skill",
          status: "live",
          desc: "Pricing & Availability lookups via Telegram. SPA/PA formats. Paths updated to VPS.",
          updated: "2026-02-23"
        },
        {
          name: "Generation Guide Tool",
          status: "testing",
          desc: "SKU generation transition tool. Waiting on user feedback.",
          updated: "2026-02-13"
        },
        {
          name: "Portfolio Dashboard",
          status: "live",
          desc: "Voting Yields section live. LP abandoned Feb 21 ‚Äî pure voting yield. Burn decision Wed Feb 25.",
          updated: "2026-02-22"
        }
      ],
      highPriority: [
        {
          name: "LLM Cost Optimization",
          status: "queued",
          desc: "Research cheaper models for routine tasks. No work started.",
          updated: "2026-02-13"
        },
        {
          name: "Portor Cross Tool",
          status: "in-progress",
          desc: "389 fixtures, 78 dead URLs. PDF extractor ready. Needs ground-up re-plan with AI backend.",
          updated: "2026-02-19"
        },
        {
          name: "Automated Trading Bot",
          status: "queued",
          tag: "‚è≥ DATA COLLECTION",
          desc: "Waiting on optimization pipeline results before building copy trading execution layer.",
          updated: "2026-02-23"
        }
      ],
      needsPlanning: [
        {
          name: "Camarie Photography",
          status: "queued",
          desc: "Email automation + SMS campaigns.",
          updated: "2026-02-22"
        }
      ],
      backBurner: [
        {
          name: "Power Track Tool",
          status: "queued",
          desc: "Most complex build. Parked.",
          updated: "2026-02-11"
        },
        {
          name: "Rep Hubs",
          status: "queued",
          desc: "Index file built, paused.",
          updated: "2026-02-11"
        }
      ],
      completed: [
        {
          name: "VPS Migration",
          status: "live",
          desc: "Rook migrated from WSL2 ‚Üí VPS (138.197.64.68). Single operator, 24/7. OpenClaw uninstalled from local.",
          updated: "2026-02-23"
        },
        {
          name: "NOVA TGE / Airdrop",
          status: "live",
          desc: "855,211.5 veNOVA received. $0 cost basis. Pure voting yield play.",
          updated: "2026-02-21"
        },
        {
          name: "Portor Architecture Audit",
          status: "live",
          desc: "4 cloud functions, 15 GCS folders, all data sources documented. Changelog protocol formalized.",
          updated: "2026-02-23"
        },
        {
          name: "Portor Pricing Tool",
          status: "live",
          desc: "Max Lumens column. Deployed to GCS.",
          updated: "2026-02-20"
        },
        {
          name: "Portor Pole Pricing (Distribution)",
          status: "live",
          desc: "Cloned from Main, stripped 5% columns. Deployed to GCS.",
          updated: "2026-02-19"
        },
        {
          name: "GCS Versioning",
          status: "live",
          desc: "portor-sales-portal bucket: versioning ON, 90-day lifecycle prune.",
          updated: "2026-02-17"
        },
        {
          name: "Netrunner v2 Command Center",
          status: "live",
          desc: "AI ops dashboard. Hosted on GitHub Pages.",
          updated: "2026-02-23"
        },
        {
          name: "Portor Knowledge Base",
          status: "live",
          desc: "487 products, 5 warehouses, all cloud functions mapped.",
          updated: "2026-02-11"
        }
      ]
    };

    const MEMORY_FILES = [
      {
        path: "MEMORY.md",
        size: 4301,
        updated: "2026-02-21T15:03:00",
        content: "# Long-term memory. Identity, hard rules, shortcuts, crypto strategy, intel system, role division, session management, GCP coordination."
      },
      {
        path: "memory/projects/projects.md",
        size: 2290,
        updated: "2026-02-18T16:34:00",
        content: "Master project status list ‚Äî active, high priority, queued, back burner."
      },
      {
        path: "memory/projects/crypto/black-nova-strategy.md",
        size: 15631,
        updated: "2026-02-21T20:16:00",
        content: "BLACK/NOVA strategy revised. LP abandoned Feb 21, pure voting yield play. Burn vs loan decision Wed Feb 25."
      },
      {
        path: "memory/projects/portor/portor-knowledge-base.md",
        size: 22901,
        updated: "2026-02-11T14:21:00",
        content: "487 products, 5 warehouses, 127 clearance items, 427 competitor crosses, all cloud function pipelines mapped."
      },
      {
        path: "memory/projects/louisville/louisville-thresholds.md",
        size: 2011,
        updated: "2026-02-13T17:02:00",
        content: "Louisville key thresholds, pallet quantities, rep-requested SKUs, tier system, threshold resolution order."
      },
      {
        path: "memory/projects/portor/cloud-reference/portor-cloud-reference.md",
        size: 1997,
        updated: "2026-02-13T16:51:00",
        content: "GCP project details, live site URLs, cloud function triggers, deploy commands, branding reference."
      },
      {
        path: "memory/daily/2026-02/2026-02-22.md",
        size: 1724,
        updated: "2026-02-23T02:00:00",
        content: "Day 12 ‚Äî NOVA -46% intraday, portfolio -76% from Oct. Scout: 52.8% WR, +0.51%. 4 pending recs. xAI sentiment still broken."
      },
      {
        path: "memory/daily/2026-02/2026-02-21.md",
        size: 956,
        updated: "2026-02-21T20:16:00",
        content: "Day 11 ‚Äî LP abandoned, pure voting yield strategy, burn vs loan decision set for Wed Feb 25."
      },
      {
        path: "memory/daily/2026-02/2026-02-20.md",
        size: 3310,
        updated: "2026-02-21T02:00:00",
        content: "Day 10 ‚Äî Lumen pipeline (291 SKUs), scalp.html Rec #1+#3, voting yields section, inventory+pricing Max Lumens columns, 'Log it' codeword, Fang Finance analysis."
      },
      {
        path: "memory/daily/2026-02/2026-02-19.md",
        size: 2514,
        updated: "2026-02-20T02:00:00",
        content: "Day 9 ‚Äî NOVA LP exited, scout fixes, Pole Pricing Distribution deployed, Project SOP rolled out to all 18 dirs."
      },
      {
        path: "memory/daily/2026-02/2026-02-18.md",
        size: 7079,
        updated: "2026-02-19T02:00:00",
        content: "Day 8 ‚Äî Scout report + 6 fixes, Netrunner glow v2, Louisville replenishment deployed, Pole Pricing specMap fix."
      },
      {
        path: "memory/daily/2026-02/2026-02-17.md",
        size: 10606,
        updated: "2026-02-18T02:00:00",
        content: "Day 7 ‚Äî NOVA TGE complete, portfolio dashboard updated, security audit done, backup systems live, Pole Pricing rebuilt."
      },
      {
        path: "memory/daily/2026-02/2026-02-16.md",
        size: 9179,
        updated: "2026-02-17T18:46:00",
        content: "Day 6 ‚Äî NOVA airdrop snapshot, Dunk bootstrap, Signal Engine changelog (regime detection, ranging penalty)."
      },
      {
        path: "memory/daily/2026-02/2026-02-14.md",
        size: 9454,
        updated: "2026-02-17T18:46:00",
        content: "Day 4 ‚Äî SuperNova playbook, crypto deep dives, investment framework established."
      },
      {
        path: "memory/daily/2026-02/2026-02-13.md",
        size: 3510,
        updated: "2026-02-17T18:46:00",
        content: "Day 3 ‚Äî Louisville dashboard, Netrunner v2, Cloud Rook brain sync, Signal Engine deploy."
      },
      {
        path: "memory/daily/2026-02/2026-02-12.md",
        size: 3186,
        updated: "2026-02-12T14:35:00",
        content: "Day 2 ‚Äî Scalp analysis, confidence rebalance, Scout created, GitHub auth, Cloud Rook deployed."
      },
      {
        path: "memory/daily/2026-02/2026-02-11.md",
        size: 2289,
        updated: "2026-02-11T14:27:00",
        content: "Day 1 ‚Äî Named Rook. SOUL.md, AGENTS.md, Portor KB built, first P&A queries."
      },
      {
        path: "memory/reference/lessons.md",
        size: 732,
        updated: "2026-02-12T16:51:00",
        content: "Key lessons: present options before building, check native features before custom solutions."
      },
      {
        path: "memory/tasks/2026-W08.md",
        size: 1507,
        updated: "2026-02-18T16:35:00",
        content: "Week 8 task tracking."
      },
      {
        path: "memory/tasks/2026-W07.md",
        size: 2489,
        updated: "2026-02-12T18:27:00",
        content: "Week 7 task tracking."
      },
      {
        path: "memory/cron-registry.md",
        size: 1953,
        updated: "2026-02-18T16:35:00",
        content: "All scheduled cron jobs with IDs, schedules, and status."
      },
      {
        path: "memory/decisions.md",
        size: 2132,
        updated: "2026-02-18T17:07:00",
        content: "Dated decision log ‚Äî Project SOP, Dunk ownership, model usage rules."
      }
    ];

    const SYSTEM_HEALTH = {
      desktopGateway: { label: "Desktop Gateway", status: "running", details: "OpenClaw 2026.2.14 ¬∑ Port 18789 ¬∑ WSL2 ¬∑ Opus ¬∑ 21% context (main session)" },
      cloudVPS: { label: "Cloud VPS (Dunk)", status: "online", details: "138.197.64.68 ¬∑ Up 11d 11h ¬∑ Load 0.08 ¬∑ 2 users ¬∑ SSH OK ¬∑ Ping 32ms" },
      signalEngine: { label: "Signal Engine", status: "running", details: "pm2 managed ¬∑ PID 192281 ¬∑ 112MB RAM ¬∑ 5 restarts ¬∑ 5d 8h uptime ¬∑ Auto-restart on crash" },
      gcloudAuth: { label: "gcloud Auth", status: "expired", details: "brandon@portorindustry.com ‚Äî needs gcloud auth login" },
      githubAuth: { label: "GitHub Auth", status: "active", details: "Windows credential-manager via WSL ¬∑ Netrunner repo: brancammedia/netrunner" },
      anthropicAPI: { label: "Anthropic API", status: "active", details: "OAuth token ¬∑ claude-opus-4-6 ¬∑ Flat rate ‚Äî no per-token billing" },
      deployment: { label: "Last GCS Deploy", status: "expired", details: "Blocked ‚Äî gcloud auth expired" }
    };

    const DOM = {
      clock: document.getElementById("clock"),
      refreshBtn: document.getElementById("refreshBtn"),
      themeBtn: document.getElementById("themeBtn"),
      agentPanel: document.getElementById("agentPanel"),
      sessionPanel: document.getElementById("sessionPanel"),
      cronPanel: document.getElementById("cronPanel"),
      projectPanel: document.getElementById("projectPanel"),
      memoryPanel: document.getElementById("memoryPanel"),
      healthPanel: document.getElementById("healthPanel")
    };

    function toLocaleTime(value) {
      if (!value) return "N/A";
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) return String(value);
      return date.toLocaleString([], {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
    }

    function percent(used, max) {
      if (!max || max <= 0) return 0;
      return Math.max(0, Math.min(100, (used / max) * 100));
    }

    function contextClass(pct) {
      if (pct >= 90) return "bad";
      if (pct >= 70) return "warn";
      return "";
    }

    function money(value) {
      return "$" + Number(value || 0).toFixed(2);
    }

    function escapeHtml(text) {
      return String(text)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;");
    }

    function renderMarkdown(md) {
      let html = escapeHtml(md);
      html = html.replace(/^### (.+)$/gm, "<h3>$1</h3>");
      html = html.replace(/^## (.+)$/gm, "<h2>$1</h2>");
      html = html.replace(/^# (.+)$/gm, "<h1>$1</h1>");
      html = html.replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>");
      html = html.replace(/`([^`]+)`/g, "<code>$1</code>");
      html = html.replace(/^- (.+)$/gm, "<li>$1</li>");
      html = html.replace(/(<li>.*<\/li>)/gs, "<ul>$1</ul>");
      html = html.replace(/\n{2,}/g, "</p><p>");
      html = "<p>" + html + "</p>";
      html = html.replace(/<p><h/g, "<h").replace(/<\/h([1-3])><\/p>/g, "</h$1>");
      html = html.replace(/<p><ul>/g, "<ul>").replace(/<\/ul><\/p>/g, "</ul>");
      return html;
    }

    function renderAgents() {
      const cards = AGENTS.map((agent) => {
        const used = agent.contextUsed || 0;
        const max = agent.contextMax || CONFIG.contextMaxDefault;
        const pct = percent(used, max);
        const barClass = contextClass(pct);
        const extra = agent.id === "scout"
          ? `<div class="subtle">Last run: ${toLocaleTime(agent.lastRun)}<br>Next run: ${toLocaleTime(agent.nextRun)}<br>${escapeHtml(agent.summary || "")}</div>`
          : `<div class="subtle">Host: ${escapeHtml(agent.host || "N/A")} ${agent.uptime ? "<br>Uptime: " + escapeHtml(agent.uptime) : ""}</div>`;

        return `
          <article class="agent-card">
            <div class="row">
              <div class="mono"><strong>${escapeHtml(agent.icon)} ${escapeHtml(agent.name)}</strong></div>
              <span class="dot ${escapeHtml(agent.status)}" title="${escapeHtml(agent.status)}"></span>
            </div>
            <div class="subtle">Model: <span class="mono">${escapeHtml(agent.model || "N/A")}</span></div>
            <div class="row mono"><span>Context</span><span>${used.toLocaleString()} / ${max.toLocaleString()} (${pct.toFixed(1)}%)</span></div>
            <div class="bar ${barClass}"><span style="width:${pct.toFixed(1)}%"></span></div>
            <div class="subtle">Last active: ${toLocaleTime(agent.lastActive || agent.lastRun)}</div>
            ${extra}
          </article>`;
      }).join("");

      DOM.agentPanel.innerHTML = `<div class="agent-grid">${cards}</div><div class="hint">Shortcut: press 1 to jump here.</div>`;
    }
    function renderSessions() {
      const sorted = [...SESSIONS].sort((a, b) => percent(b.contextUsed, b.contextMax) - percent(a.contextUsed, a.contextMax));
      const rows = sorted.map((session) => {
        const pct = percent(session.contextUsed, session.contextMax);
        const rowClass = pct >= 90 ? "context-critical" : pct >= 70 ? "context-warning" : "";
        const barClass = contextClass(pct);
        return `
          <tr class="${rowClass}">
            <td class="mono">${escapeHtml(session.label)}</td>
            <td>${escapeHtml(session.type)}</td>
            <td class="mono">${escapeHtml(session.model)}</td>
            <td>
              <div class="mono">${session.contextUsed.toLocaleString()} / ${session.contextMax.toLocaleString()} (${pct.toFixed(1)}%)</div>
              <div class="bar ${barClass}" style="margin-top:5px;"><span style="width:${pct.toFixed(1)}%"></span></div>
            </td>
            <td class="mono">${money(session.cost)}</td>
            <td class="mono">${toLocaleTime(session.lastMessage)}</td>
            <td>${escapeHtml(session.channel)}</td>
          </tr>`;
      }).join("");

      DOM.sessionPanel.innerHTML = `
        <div style="max-height:360px; overflow:auto;">
          <table>
            <thead>
              <tr>
                <th>Session</th>
                <th>Type</th>
                <th>Model</th>
                <th>Context</th>
                <th>Cost</th>
                <th>Last Message</th>
                <th>Channel</th>
              </tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
        </div>
        <div class="hint">Shortcut: press 2 to jump here. Rows are highlighted above 70%/90% context use.</div>`;
    }

    function renderCron() {
      const rows = CRON_JOBS.map((job) => `
        <tr>
          <td>${escapeHtml(job.name)}</td>
          <td class="mono">${escapeHtml(job.schedule)}</td>
          <td><span class="badge ${job.enabled ? "enabled" : "disabled"}">${job.enabled ? "Enabled" : "Disabled"}</span></td>
          <td class="mono">${toLocaleTime(job.lastRun)}<br><span class="badge ${job.lastResult === "success" ? "success" : "fail"}">${escapeHtml(job.lastResult)}</span></td>
          <td class="mono">${toLocaleTime(job.nextFire)}</td>
        </tr>`).join("");

      DOM.cronPanel.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Job</th>
              <th>Schedule</th>
              <th>Status</th>
              <th>Last Run</th>
              <th>Next Fire</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <div class="hint">Shortcut: press 3 to jump here.</div>`;
    }

    function projectCard(item) {
      return `
        <article class="project-item">
          <div class="row">
            <strong>${escapeHtml(item.name)}</strong>
            ${item.tag ? `<span class="badge" style="background:#b8860b;color:#fff;font-size:0.7em;margin-left:6px">${escapeHtml(item.tag)}</span>` : ""}
            <span class="badge ${escapeHtml(item.status)}">${escapeHtml(item.status)}</span>
          </div>
          <div class="subtle">${escapeHtml(item.desc)}</div>
          <div class="mono subtle">Updated: ${escapeHtml(item.updated)}</div>
        </article>`;
    }

    function renderProjectGroup(title, items) {
      return `
        <section class="project-group">
          <h4>${escapeHtml(title)}</h4>
          ${items.length ? items.map(projectCard).join("") : "<div class='subtle'>No items</div>"}
        </section>`;
    }

    function renderProjects() {
      DOM.projectPanel.innerHTML = `
        <div class="projects-wrap">
          ${renderProjectGroup("Active Projects", PROJECTS.active)}
          ${renderProjectGroup("High Priority", PROJECTS.highPriority)}
          ${renderProjectGroup("Needs Planning", PROJECTS.needsPlanning)}
          ${renderProjectGroup("Back Burner", PROJECTS.backBurner)}
        </div>
        <details style="margin-top:10px;">
          <summary class="mono" style="cursor:pointer;">Completed</summary>
          <div style="margin-top:8px;">
            ${PROJECTS.completed.map(projectCard).join("")}
          </div>
        </details>
        <div class="hint">Shortcut: press 4 to jump here.</div>`;
    }

    function renderMemoryList(filtered, activePath) {
      return filtered.map((file) => `
        <article class="memory-item ${file.path === activePath ? "active" : ""}" data-path="${escapeHtml(file.path)}">
          <div class="mono"><strong>${escapeHtml(file.path)}</strong></div>
          <div class="subtle">${file.size.toLocaleString()} bytes</div>
          <div class="subtle">${toLocaleTime(file.updated)}</div>
        </article>`).join("");
    }

    function renderMemory() {
      let activePath = MEMORY_FILES[0] ? MEMORY_FILES[0].path : "";
      let query = "";

      DOM.memoryPanel.innerHTML = `
        <div class="memory-layout">
          <section class="panel">
            <header>
              <div>File Search</div>
              <div style="margin-top:8px;"><input class="memory-search" id="memorySearch" placeholder="Search file name or content..." /></div>
            </header>
            <div class="memory-list" id="memoryList"></div>
          </section>
          <section class="panel">
            <header id="memoryTitle">Preview</header>
            <div class="memory-view" id="memoryView">Select a file to view contents.</div>
          </section>
        </div>
        <div class="hint">Shortcut: press 5 to jump here. Static snapshot mode is active.</div>`;

      const searchEl = document.getElementById("memorySearch");
      const listEl = document.getElementById("memoryList");
      const viewEl = document.getElementById("memoryView");
      const titleEl = document.getElementById("memoryTitle");

      function matchingFiles() {
        const needle = query.trim().toLowerCase();
        if (!needle) return MEMORY_FILES;
        return MEMORY_FILES.filter((file) => {
          return file.path.toLowerCase().includes(needle) || file.content.toLowerCase().includes(needle);
        });
      }

      function renderDetail() {
        const files = matchingFiles();
        if (!files.find((f) => f.path === activePath) && files[0]) {
          activePath = files[0].path;
        }
        listEl.innerHTML = renderMemoryList(files, activePath);
        const active = MEMORY_FILES.find((f) => f.path === activePath);
        if (!active) {
          titleEl.textContent = "Preview";
          viewEl.textContent = "No files match the current search.";
          return;
        }
        titleEl.textContent = `${active.path} - ${active.size.toLocaleString()} bytes`;
        viewEl.innerHTML = renderMarkdown(active.content);
      }

      searchEl.addEventListener("input", () => {
        query = searchEl.value || "";
        renderDetail();
      });

      listEl.addEventListener("click", (event) => {
        const target = event.target.closest(".memory-item");
        if (!target) return;
        activePath = target.getAttribute("data-path") || activePath;
        renderDetail();
      });

      renderDetail();
    }

    function renderHealth() {
      const rows = Object.values(SYSTEM_HEALTH).map((item) => `
        <article class="health-card">
          <div class="health-row">
            <strong>${escapeHtml(item.label)}</strong>
            <span class="mono health-state ${escapeHtml(item.status)}">${escapeHtml(item.status)}</span>
          </div>
          <div class="subtle">${escapeHtml(item.details)}</div>
        </article>`).join("");

      DOM.healthPanel.innerHTML = `
        <div class="health-grid">${rows}</div>
        <div class="hint">Shortcut: press 6 to jump here.</div>`;
    }

    function renderAllPanels() {
      renderAgents();
      renderSessions();
      renderCron();
      renderProjects();
      renderMemory();
      renderHealth();
    }
    async function refreshData() {
      if (CONFIG.mode === "live") {
        // Live mode hook for future API integration.
      }
      renderAllPanels();
      document.body.classList.add("flash");
      setTimeout(() => document.body.classList.remove("flash"), 700);
    }

    function setTheme(theme) {
      const safeTheme = theme === "light" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", safeTheme);
      localStorage.setItem(CONFIG.themeStorageKey, safeTheme);
    }

    function initTheme() {
      const saved = localStorage.getItem(CONFIG.themeStorageKey);
      if (saved === "light" || saved === "dark") {
        setTheme(saved);
      } else {
        setTheme("dark");
      }
    }

    function setupClock() {
      function tick() {
        DOM.clock.textContent = new Date().toLocaleString([], {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit"
        });
      }
      tick();
      setInterval(tick, 1000);
    }

    function togglePane(paneId) {
      const pane = document.getElementById(paneId);
      if (!pane) return;
      pane.classList.toggle("collapsed");
      const button = pane.querySelector(".collapse-btn");
      if (button) {
        const expanded = !pane.classList.contains("collapsed");
        button.setAttribute("aria-expanded", expanded ? "true" : "false");
        button.textContent = expanded ? "Collapse" : "Expand";
      }
    }

    function jumpToModule(index) {
      const target = document.getElementById(`module-${index}`);
      if (!target) return;
      target.scrollIntoView({ behavior: "smooth", block: "start" });
      target.classList.add("flash");
      setTimeout(() => target.classList.remove("flash"), 700);
    }

    function bindEvents() {
      DOM.refreshBtn.addEventListener("click", refreshData);
      DOM.themeBtn.addEventListener("click", () => {
        const next = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
        setTheme(next);
      });

      document.querySelectorAll(".collapse-btn").forEach((button) => {
        button.addEventListener("click", () => togglePane(button.getAttribute("data-pane")));
      });

      document.addEventListener("keydown", (event) => {
        if (event.target && (event.target.tagName === "INPUT" || event.target.tagName === "TEXTAREA")) {
          return;
        }
        const key = event.key.toLowerCase();
        if (["1", "2", "3", "4", "5", "6"].includes(key)) {
          jumpToModule(key);
        } else if (key === "r") {
          refreshData();
        } else if (key === "t") {
          const next = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
          setTheme(next);
        }
      });
    }

    function init() {
      initTheme();
      setupClock();
      renderAllPanels();
      bindEvents();
    }

    init();
  </script>
</body>
</html>

